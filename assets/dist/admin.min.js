!function(){"use strict";var e=class{constructor(e={}){this.options={containerSelector:"#ace-redis-settings-form",saveButtonSelector:"#ace-redis-save-btn",messageContainerSelector:"#ace-redis-messages",onSave:null,autoSaveEnabled:!1,autoSaveInterval:3e4,...e},this.isInitialized=!1,this.hasUnsavedChanges=!1,this.isSaving=!1,this.isSuccess=!1,this.message="",this.elapsedTime=0,this.intervalId=null,this.autoSaveIntervalId=null,this.originalFormData=null,this.init()}init(){this.isInitialized||(this.createSaveBar(),this.setupEventListeners(),this.captureOriginalFormData(),this.updateSaveButtonState(),this.isInitialized=!0)}createSaveBar(){if(document.querySelector(".ace-redis-save-bar"))return;const e=localStorage.getItem("ace_redis_cache_auto_save_enabled");null!==e&&(this.options.autoSaveEnabled="1"===e);const t=`\n            <div class="ace-redis-save-bar">\n                <div class="save-bar-content">\n                    <div class="save-bar-left">\n                        <span class="save-message"></span>\n                    </div>\n                    <div class="save-bar-right">\n                        <div class="auto-save-toggle">\n                            <label>\n                                <input type="checkbox" id="auto-save-toggle" ${this.options.autoSaveEnabled?"checked":""}>\n                                <span class="toggle-slider"></span>\n                                Auto Save (${this.options.autoSaveInterval/1e3}s)\n                            </label>\n                        </div>\n                        <button type="button" id="save-bar-button" class="button button-primary" disabled>\n                            <span class="dashicons dashicons-admin-settings"></span>\n                            <span class="button-text">Saved</span>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;document.body.insertAdjacentHTML("beforeend",t),this.updateFixedPosition(),this.options.autoSaveEnabled&&this.startAutoSave()}setupEventListeners(){$(this.options.containerSelector).on("input change","input, select, textarea",()=>{setTimeout(()=>this.checkForChanges(),10)}),$(document).on("click","#save-bar-button",e=>{e.preventDefault(),this.handleSave()}),$(document).on("change","#auto-save-toggle",e=>{this.options.autoSaveEnabled=e.target.checked,this.toggleAutoSave(),localStorage.setItem("ace_redis_cache_auto_save_enabled",this.options.autoSaveEnabled?"1":"0"),this.options.autoSaveEnabled?this.showMessage(`Auto-save enabled! Changes will be saved every ${this.options.autoSaveInterval/1e3} seconds.`,"info"):this.showMessage("Auto-save disabled.","info")}),$(window).on("resize scroll load",()=>this.updateFixedPosition()),$(window).on("beforeunload",e=>{if(this.hasUnsavedChanges&&!this.isSaving){const t="You have unsaved changes. Are you sure you want to leave?";return e.originalEvent.returnValue=t,t}}),window.wp&&wp.hooks&&wp.hooks.addAction("wp-collapse-menu","ace-redis-cache",()=>{setTimeout(()=>this.updateFixedPosition(),300)})}updateFixedPosition(){const e=document.querySelector(".ace-redis-save-bar");if(!e)return;const t=document.querySelector("#adminmenuwrap");if(t){const s=t.offsetWidth;e.style.left=`${s}px`}}captureOriginalFormData(){const e=$(this.options.containerSelector);this.originalFormData=this.getFormDataObject(e)}getFormDataObject(e){const t={};return e.serializeArray().forEach(e=>{if(e.name.startsWith("ace_redis_cache_settings[")){const s=e.name.replace("ace_redis_cache_settings[","").replace("]","");t[s]=e.value}}),e.find('input[type="checkbox"]').each(function(){const e=$(this).attr("name");if(e&&e.startsWith("ace_redis_cache_settings[")){const s=e.replace("ace_redis_cache_settings[","").replace("]","");t[s]=$(this).is(":checked")?"1":"0"}}),t}checkForChanges(){if(!this.originalFormData)return;const e=$(this.options.containerSelector),t=this.getFormDataObject(e),s=JSON.stringify(this.originalFormData)!==JSON.stringify(t);this.setUnsavedChanges(s)}setUnsavedChanges(e){this.hasUnsavedChanges=e,this.updateSaveButtonState()}updateSaveButtonState(){const e=$("#save-bar-button"),t=e.find(".button-text"),s=e.find(".dashicons");this.isSaving?(e.prop("disabled",!0).removeClass("success"),t.text("Saving..."),s.removeClass("dashicons-admin-settings dashicons-yes-alt").addClass("dashicons-update")):this.isSuccess?(e.prop("disabled",!0).addClass("success"),t.text("Saved!"),s.removeClass("dashicons-admin-settings dashicons-update").addClass("dashicons-yes-alt")):this.hasUnsavedChanges?(e.prop("disabled",this.options.autoSaveEnabled).removeClass("success"),t.text(this.options.autoSaveEnabled?"Auto-saving...":"Save Changes"),s.removeClass("dashicons-update dashicons-yes-alt").addClass("dashicons-admin-settings"),this.options.autoSaveEnabled?e.addClass("auto-saving"):e.removeClass("auto-saving")):(e.prop("disabled",!0).removeClass("success"),t.text("Saved"),s.removeClass("dashicons-update dashicons-yes-alt").addClass("dashicons-admin-settings"))}async handleSave(e=!1){if(this.hasUnsavedChanges&&!this.isSaving){this.setSaving(!0);try{let t=!1;if(t=this.options.onSave&&"function"==typeof this.options.onSave?await this.options.onSave():await this.defaultSave(),t){const t=e?`Auto-saved successfully! (${(new Date).toLocaleTimeString()})`:"Settings saved successfully!";this.showMessage(t,"success"),this.setSuccess(!0),this.captureOriginalFormData(),this.setUnsavedChanges(!1),setTimeout(()=>this.setSuccess(!1),e?2e3:3e3)}else{const t=e?"Auto-save failed. Please save manually.":"Failed to save settings. Please try again.";this.showMessage(t,"error"),e&&(this.options.autoSaveEnabled=!1,$("#auto-save-toggle").prop("checked",!1),this.stopAutoSave(),localStorage.setItem("ace_redis_cache_auto_save_enabled","0"))}}catch(t){console.error("Save error:",t);const s=e?"Auto-save error occurred. Auto-save disabled.":"An error occurred while saving. Please try again.";this.showMessage(s,"error"),e&&(this.options.autoSaveEnabled=!1,$("#auto-save-toggle").prop("checked",!1),this.stopAutoSave(),localStorage.setItem("ace_redis_cache_auto_save_enabled","0"))}finally{this.setSaving(!1)}}}async defaultSave(){return new Promise(e=>{const t=$(this.options.containerSelector),s=this.getFormDataObject(t);$.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/settings",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},data:{settings:s,nonce:ace_redis_admin.nonce},success:t=>{e(!0===t.success)},error:()=>{e(!1)}})})}setSaving(e){this.isSaving=e,this.updateSaveButtonState()}setSuccess(e){this.isSuccess=e,this.updateSaveButtonState()}showMessage(e,t="info"){this.message=e,this.updateMessageDisplay(t),"success"===t&&this.startElapsedTimeTracking();setTimeout(()=>{this.clearMessage()},"error"===t?8e3:"success"===t?5e3:3e3)}updateMessageDisplay(e="info"){const t=$(".save-message");this.message?t.text(this.message).addClass("visible").removeClass("error success info").addClass(e):t.removeClass("visible error success info").text("")}clearMessage(){this.message="",this.updateMessageDisplay(),this.stopElapsedTimeTracking()}startElapsedTimeTracking(){this.stopElapsedTimeTracking(),this.elapsedTime=0,this.intervalId=setInterval(()=>{this.elapsedTime++,this.updateElapsedTimeDisplay()},1e3)}stopElapsedTimeTracking(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}updateElapsedTimeDisplay(){if(this.elapsedTime>0){const e=this.formatElapsedTime(this.elapsedTime);$(".save-message").text(e)}}formatElapsedTime(e){return e<60?`Saved ${e} seconds ago`:e<3600?`Saved ${Math.floor(e/60)} minutes ago`:`Saved ${Math.floor(e/3600)} hours ago`}toggleAutoSave(){this.options.autoSaveEnabled?this.startAutoSave():this.stopAutoSave()}startAutoSave(){this.stopAutoSave(),console.log(`Starting auto-save with ${this.options.autoSaveInterval/1e3}s interval`),this.autoSaveIntervalId=setInterval(()=>{this.hasUnsavedChanges&&!this.isSaving&&(console.log("Auto-save triggered - saving changes..."),this.showMessage("Auto-saving changes...","info"),this.handleSave(!0))},this.options.autoSaveInterval),this.showMessage(`Auto-save started! Changes will be saved every ${this.options.autoSaveInterval/1e3} seconds.`,"success")}stopAutoSave(){this.autoSaveIntervalId&&(console.log("Stopping auto-save"),clearInterval(this.autoSaveIntervalId),this.autoSaveIntervalId=null)}destroy(){this.stopElapsedTimeTracking(),this.stopAutoSave(),$(this.options.containerSelector).off("input change"),$(document).off("click","#save-bar-button"),$(document).off("change","#auto-save-toggle"),$(window).off("resize scroll load"),$(window).off("beforeunload"),$(".ace-redis-save-bar").remove(),this.isInitialized=!1}};!function(t){window.AceRedisCacheSaveBar=e;class s{constructor(){this.originalFormData=null,this.init()}init(){this.initTabs(),this.initToggleSwitch(),this.initCacheMode(),this.initConnectionTest(),this.initCacheManagement(),this.initDiagnostics(),this.initPerformanceMetrics(),this.initAjaxForm(),this.initFormValidation(),this.initChangeTracking(),this.initSaveBar()}initSaveBar(){void 0!==window.AceRedisCacheSaveBar?(this.saveBar=new window.AceRedisCacheSaveBar({containerSelector:"#ace-redis-settings-form",saveButtonSelector:"#ace-redis-save-btn",messageContainerSelector:"#ace-redis-messages",onSave:()=>this.saveSettingsViaSaveBar(),autoSaveEnabled:!1,autoSaveInterval:15e3}),console.log("SaveBar initialized successfully")):console.warn("SaveBar component not loaded, falling back to standard save handling")}async saveSettingsViaSaveBar(){try{const e=await this.performSaveSettings();return e&&setTimeout(()=>{"function"==typeof this.testConnection&&this.testConnection()},1e3),e}catch(e){return console.error("SaveBar save error:",e),!1}}async performSaveSettings(){return new Promise(e=>{t("#ace-redis-settings-form");const s=this.getFormDataObject();t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/settings",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},data:{settings:s,nonce:ace_redis_admin.nonce},success:t=>{t.success?(this.captureOriginalFormData(),e(!0)):e(!1)},error:()=>{e(!1)}})})}initTabs(){t(".nav-tab").on("click",e=>{e.preventDefault();const s=t(e.target).attr("href");this.switchToTab(s),s.startsWith("#")&&(window.location.hash=s)}),t(window).on("hashchange",()=>{this.handleHashChange()}),this.handleHashChange()}switchToTab(e){e&&t(e).length&&(t(".nav-tab").removeClass("nav-tab-active"),t(`.nav-tab[href="${e}"]`).addClass("nav-tab-active"),t(".tab-content.active").removeClass("active"),setTimeout(()=>{t(e).addClass("active"),"#diagnostics"===e?(setTimeout(()=>{t("#refresh-metrics-btn").click()},100),this.resumeAutoRefreshTimer()):this.pauseAutoRefreshTimer()},50))}handleHashChange(){let e=window.location.hash;if(!e||!t(e).length){const s=t(".nav-tab").first().attr("href");s&&(e=s)}e&&t(e).length&&this.switchToTab(e)}initToggleSwitch(){t(".ace-switch input").on("change",function(){const e=t(this),s=e.siblings(".ace-slider");e.is(":checked")?s.addClass("checked"):s.removeClass("checked")})}initCacheMode(){const e=()=>{const e=t("#cache-mode-select").val(),s=t("#block-caching-row"),a=t('input[name="ace_redis_cache_settings[enable_block_caching]"]');"object"===e?s.show():(s.hide(),a.prop("checked",!1))};e(),t("#cache-mode-select").on("change",e)}initConnectionTest(){t("#ace-redis-cache-test-btn").on("click",e=>{e.preventDefault(),this.testConnection()}),t("#ace-redis-cache-test-write-btn").on("click",e=>{e.preventDefault(),this.testWriteRead()})}testConnection(){const e=t("#ace-redis-cache-test-btn"),s=e.text();e.text("Testing...").prop("disabled",!0),t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/test-connection",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},data:{nonce:ace_redis_admin.nonce}}).done(e=>{e.success?this.updateConnectionStatus(e.data):this.showConnectionError(e.data||"Connection failed")}).fail(()=>{this.showConnectionError("REST API request failed")}).always(()=>{e.text(s).prop("disabled",!1)})}testWriteRead(){const e=t("#ace-redis-cache-test-write-btn"),s=e.text();e.text("Testing...").prop("disabled",!0),t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/test-write-read",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},data:{nonce:ace_redis_admin.nonce}}).done(e=>{e.success?this.showNotification(`✅ Write/Read Test Successful\nWrite: ${e.data.write}\nRead: ${e.data.read}\nValue: ${e.data.value}`,"success"):this.showNotification(`❌ Test failed: ${e.data}`,"error")}).fail(()=>{this.showNotification("❌ REST API request failed","error")}).always(()=>{e.text(s).prop("disabled",!1)})}updateConnectionStatus(e){const s=t("#ace-redis-cache-connection"),a=t("#ace-redis-cache-size"),i=t("#redis-server-info"),n=t("#redis-server-type"),o=t("#redis-suggestions");s.text(e.status).removeClass("status-unknown status-error").addClass("status-success");let r=`${e.size} keys (${e.size_kb} KB)`;if(e.debug_info&&(r+=` - ${e.debug_info}`),a.text(r),e.server_type||e.suggestions){if(n.text(e.server_type||"Unknown"),e.suggestions&&e.suggestions.length>0){let t="<p><strong>Recommendations:</strong></p><ul>";e.suggestions.forEach(e=>{t+=`<li>${e}</li>`}),t+="</ul>",o.html(t)}else o.html("<p><strong>Recommendations:</strong> Configuration looks good ✅</p>");i.slideDown(300)}}showConnectionError(e){const s=t("#ace-redis-cache-connection"),a=t("#ace-redis-cache-size"),i=t("#redis-server-info");s.text(e).removeClass("status-unknown status-success").addClass("status-error"),a.text("0 keys (0 KB)"),i.slideUp(300)}initCacheManagement(){t("#ace-redis-cache-flush-btn").on("click",e=>{e.preventDefault(),this.clearAllCache()}),t("#ace-redis-cache-flush-blocks-btn").on("click",e=>{e.preventDefault(),this.clearBlockCache()})}clearAllCache(){if(!confirm("Are you sure you want to clear all cache? This action cannot be undone."))return;const e=t("#ace-redis-cache-flush-btn"),s=e.text();e.text("Clearing...").prop("disabled",!0),t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/flush-cache",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},data:{nonce:ace_redis_admin.nonce,type:"all"}}).done(e=>{e.success?(this.showNotification(`✅ ${e.data.message||"Cache cleared successfully"}`,"success"),t("#ace-redis-cache-size").text("0 keys (0 KB)")):this.showNotification(`❌ Failed to clear cache: ${e.data}`,"error")}).fail(()=>{this.showNotification("❌ REST API request failed","error")}).always(()=>{e.text(s).prop("disabled",!1)})}clearBlockCache(){if(!confirm("Clear all block cache? This will remove cached Gutenberg blocks."))return;const e=t("#ace-redis-cache-flush-blocks-btn"),s=e.text();e.text("Clearing...").prop("disabled",!0),t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/flush-cache",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},data:{nonce:ace_redis_admin.nonce,type:"blocks"}}).done(e=>{e.success?(this.showNotification(`✅ ${e.data.message||"Block cache cleared"}`,"success"),setTimeout(()=>this.testConnection(),500)):this.showNotification(`❌ Failed to clear block cache: ${e.data}`,"error")}).fail(()=>{this.showNotification("❌ REST API request failed","error")}).always(()=>{e.text(s).prop("disabled",!1)})}initDiagnostics(){t("#ace-redis-cache-diagnostics-btn").on("click",e=>{e.preventDefault(),this.runDiagnostics()})}runDiagnostics(){const e=t("#ace-redis-cache-diagnostics-btn"),s=t("#diagnostics-results"),a=e.text();e.text("Running...").prop("disabled",!0),s.html("<p>⏳ Running comprehensive diagnostics...</p>"),t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/diagnostics",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},data:{nonce:ace_redis_admin.nonce}}).done(e=>{if(e.success&&e.data){const t=Array.isArray(e.data)?e.data.join("\n"):e.data;s.html(`<pre>${this.escapeHtml(t)}</pre>`)}else s.html(`<p class="error">❌ Failed to load diagnostics: ${e.data||"Unknown error"}</p>`)}).fail(()=>{s.html('<p class="error">❌ Diagnostics REST API request failed</p>')}).always(()=>{e.text(a).prop("disabled",!1)})}initFormValidation(){t("#ace-redis-save-btn").on("click",e=>{if(!this.validateForm())return e.preventDefault(),!1}),t("#redis_host").on("blur",this.validateHost),t("#redis_port").on("blur",this.validatePort),t("#cache_ttl").on("blur",this.validateTTL)}validateForm(){let e=!0;const s=[];t("#redis_host").val().trim()||(s.push("Redis host is required"),e=!1);const a=parseInt(t("#redis_port").val());(!a||a<1||a>65535)&&(s.push("Redis port must be between 1 and 65535"),e=!1);const i=parseInt(t("#cache_ttl").val());return(!i||i<60)&&(s.push("Cache TTL must be at least 60 seconds"),e=!1),e||this.showNotification(`❌ Validation errors:\n${s.join("\n")}`,"error"),e}validateHost(){const e=t(this);return e.val().trim()?(e.removeClass("error"),!0):(e.addClass("error"),!1)}validatePort(){const e=t(this),s=parseInt(e.val());return!s||s<1||s>65535?(e.addClass("error"),!1):(e.removeClass("error"),!0)}validateTTL(){const e=t(this),s=parseInt(e.val());return!s||s<60?(e.addClass("error"),!1):(e.removeClass("error"),!0)}showNotification(e,t="info"){alert(e)}initAjaxForm(){console.log("Initializing AJAX form..."),t("#ace-redis-settings-form").on("submit",e=>(console.log("Form submit intercepted"),e.preventDefault(),e.stopPropagation(),this.saveSettings(),!1)),t("#ace-redis-save-btn").on("click",e=>(console.log("Save button clicked"),e.preventDefault(),e.stopPropagation(),this.saveSettings(),!1))}initChangeTracking(){setTimeout(()=>{const e=t("#ace-redis-save-btn");e.data("original-text")||e.data("original-text",e.val()),this.captureOriginalFormData(),this.updateSaveButtonState(),t("#ace-redis-settings-form input, #ace-redis-settings-form select, #ace-redis-settings-form textarea").on("input change",()=>{setTimeout(()=>this.updateSaveButtonState(),10)})},100)}captureOriginalFormData(){this.originalFormData=this.getFormDataObject()}hasFormChanges(){if(!this.originalFormData)return!1;const e=this.getFormDataObject();return JSON.stringify(this.originalFormData)!==JSON.stringify(e)}updateSaveButtonState(){const e=t("#ace-redis-save-btn"),s=this.hasFormChanges();e.prop("disabled",!s),s?e.val(e.data("original-text")||"Save Changes"):e.val(e.data("original-text")||"Save Changes (No Changes)")}getFormDataObject(){const e=t("#ace-redis-settings-form"),s={};return e.serializeArray().forEach(e=>{if(e.name.startsWith("ace_redis_cache_settings[")){const t=e.name.replace("ace_redis_cache_settings[","").replace("]","");s[t]=e.value}}),e.find('input[type="checkbox"]').each(function(){const e=t(this).attr("name");if(e&&e.startsWith("ace_redis_cache_settings[")){const a=e.replace("ace_redis_cache_settings[","").replace("]","");s[a]=t(this).is(":checked")?"1":"0"}}),s}saveSettings(){this.saveBar?this.saveBar.handleSave():this.performOriginalSave()}performOriginalSave(){if(!this.hasFormChanges())return void this.showMessage("Error: Failed to save settings. No changes detected or database error.","error");t("#ace-redis-settings-form");const e=t("#ace-redis-save-btn"),s=t("#ace-redis-messages");console.log("REST API Save triggered...");const a=e.val();e.val("Saving...").prop("disabled",!0),s.hide();const i=this.getFormDataObject();console.log("Sending data:",i),console.log("REST URL:",ace_redis_admin.rest_url+"ace-redis-cache/v1/settings"),t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/settings",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce),console.log("Set REST nonce:",ace_redis_admin.rest_nonce)},data:{settings:i,nonce:ace_redis_admin.nonce},success:e=>{console.log("Success response:",e),e.success?(this.showMessage(e.message||"Settings saved successfully!","success"),this.captureOriginalFormData(),this.updateSaveButtonState(),setTimeout(()=>{"function"==typeof this.testConnection&&this.testConnection()},1e3)):this.showMessage(e.message||"Failed to save settings","error")},error:(e,t,s)=>{console.error("Save error:",{status:e.status,statusText:e.statusText,responseText:e.responseText,error:s});let a="Network error occurred";a=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:504===e.status?"Gateway timeout - settings may still be saved. Please refresh the page.":403===e.status?"Permission denied. Please refresh the page and try again.":404===e.status?"REST API endpoint not found. The plugin may not be properly configured.":`${s} (Status: ${e.status})`,this.showMessage("Error: "+a,"error")},complete:()=>{e.val(a).prop("disabled",!1)}})}showMessage(e,s="success"){const a=t("#ace-redis-messages"),i="success"===s?"notice-success":"notice-error";a.html(`\n                <div class="notice ${i} is-dismissible">\n                    <p>${this.escapeHtml(e)}</p>\n                    <button type="button" class="notice-dismiss">\n                        <span class="screen-reader-text">Dismiss this notice.</span>\n                    </button>\n                </div>\n            `).show(),"success"===s&&setTimeout(()=>{a.fadeOut()},5e3),a.find(".notice-dismiss").on("click",function(){a.fadeOut()})}initPerformanceMetrics(){t("#diagnostics").hasClass("active")&&setTimeout(()=>{t("#refresh-metrics-btn").click()},100),this.initAutoRefresh(),t("#refresh-metrics-btn").on("click",()=>{this.loadPerformanceMetrics();const e=t("#refresh-metrics-btn");e.prop("disabled",!0).html("⏳"),setTimeout(()=>{e.prop("disabled",!1).html("🔄")},1e3)})}initAutoRefresh(){this.autoRefreshInterval=null,this.countdownInterval=null,this.remainingSeconds=0;const e=()=>{const e=t("#refresh-timer");this.remainingSeconds>0?(e.text(`Next refresh in ${this.remainingSeconds}s`),this.remainingSeconds--):e.text("")};this.startAutoRefresh=s=>{this.autoRefreshInterval&&clearInterval(this.autoRefreshInterval),this.countdownInterval&&clearInterval(this.countdownInterval);const a=t("#refresh-timer");s>0?(this.remainingSeconds=s,this.countdownInterval=setInterval(e,1e3),this.autoRefreshInterval=setInterval(()=>{t("#diagnostics").hasClass("active")&&(t("#refresh-metrics-btn").click(),this.remainingSeconds=s)},1e3*s),e()):a.text("")},t("#auto-refresh-select").on("change",()=>{const e=parseInt(t("#auto-refresh-select").val());this.startAutoRefresh(e)}),this.startAutoRefresh(30)}pauseAutoRefreshTimer(){this.countdownInterval&&clearInterval(this.countdownInterval),t("#refresh-timer").text("")}resumeAutoRefreshTimer(){const e=parseInt(t("#auto-refresh-select").val());e>0&&this.startAutoRefresh(e)}loadPerformanceMetrics(){t("#diagnostics").hasClass("active")&&t.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/metrics",type:"GET",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce)},success:e=>{t("#diagnostics").hasClass("active")&&(e.success&&e.data||e.data)&&this.updateMetricsDisplay(e.data)},error:()=>{this.updateMetricsDisplay({cache_hit_rate:"--",total_keys:"--",memory_usage:"--",response_time:"--",uptime:"--",connected_clients:"--",ops_per_sec:"--"})}})}updateMetricsDisplay(e){t("#performance-metrics .metric-card").each(function(){const s=t(this),a=s.find(".metric-value"),i=s.find("h4").text();let n="--";switch(i){case"Cache Hit Rate":n=e.cache_hit_rate||"--";break;case"Total Keys":n=e.total_keys||"--";break;case"Memory Usage":n=e.memory_usage||"--";break;case"Response Time":n=e.response_time||"--";break;case"Uptime":n=e.uptime||"--";break;case"Connected Clients":n=e.connected_clients||"--";break;case"Operations/sec":case"Ops/sec":n=e.ops_per_sec||"--";break;case"Connection Time":n=e.connection_time||"--"}a.text()!==n?a.fadeOut(100,function(){t(this).text(n).fadeIn(100)}):a.text(n)});const s=(new Date).toLocaleTimeString();t(".metrics-last-updated").text(`Last updated: ${s}`)}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}t(document).ready(()=>{new s})}(jQuery)}();
//# sourceMappingURL=admin.min.js.map