!function(e){"use strict";class t{constructor(){this.originalFormData=null,this.init()}init(){this.initTabs(),this.initToggleSwitch(),this.initCacheMode(),this.initConnectionTest(),this.initCacheManagement(),this.initDiagnostics(),this.initPerformanceMetrics(),this.initAjaxForm(),this.initFormValidation(),this.initChangeTracking()}initTabs(){e(".nav-tab").on("click",t=>{t.preventDefault();const s=e(t.target).attr("href");this.switchToTab(s),s.startsWith("#")&&(window.location.hash=s)}),e(window).on("hashchange",()=>{this.handleHashChange()}),this.handleHashChange()}switchToTab(t){t&&e(t).length&&(e(".nav-tab").removeClass("nav-tab-active"),e(`.nav-tab[href="${t}"]`).addClass("nav-tab-active"),e(".tab-content.active").removeClass("active"),setTimeout(()=>{e(t).addClass("active")},50))}handleHashChange(){let t=window.location.hash;if(!t||!e(t).length){const s=e(".nav-tab").first().attr("href");s&&(t=s)}t&&e(t).length&&this.switchToTab(t)}initToggleSwitch(){e(".ace-switch input").on("change",function(){const t=e(this),s=t.siblings(".ace-slider");t.is(":checked")?s.addClass("checked"):s.removeClass("checked")})}initCacheMode(){const t=()=>{const t=e("#cache-mode-select").val(),s=e("#block-caching-row"),a=e('input[name="ace_redis_cache_settings[enable_block_caching]"]');"object"===t?s.show():(s.hide(),a.prop("checked",!1))};t(),e("#cache-mode-select").on("change",t)}initConnectionTest(){e("#ace-redis-cache-test-btn").on("click",e=>{e.preventDefault(),this.testConnection()}),e("#ace-redis-cache-test-write-btn").on("click",e=>{e.preventDefault(),this.testWriteRead()})}testConnection(){const t=e("#ace-redis-cache-test-btn"),s=t.text();t.text("Testing...").prop("disabled",!0),e.post(ace_redis_admin.ajax_url,{action:"ace_redis_cache_status",nonce:ace_redis_admin.nonce}).done(e=>{e.success?this.updateConnectionStatus(e.data):this.showConnectionError(e.data||"Connection failed")}).fail(()=>{this.showConnectionError("AJAX request failed")}).always(()=>{t.text(s).prop("disabled",!1)})}testWriteRead(){const t=e("#ace-redis-cache-test-write-btn"),s=t.text();t.text("Testing...").prop("disabled",!0),e.post(ace_redis_admin.ajax_url,{action:"ace_redis_cache_test_write",nonce:ace_redis_admin.nonce}).done(e=>{e.success?this.showNotification(`✅ Write/Read Test Successful\nWrite: ${e.data.write}\nRead: ${e.data.read}\nValue: ${e.data.value}`,"success"):this.showNotification(`❌ Test failed: ${e.data}`,"error")}).fail(()=>{this.showNotification("❌ AJAX request failed","error")}).always(()=>{t.text(s).prop("disabled",!1)})}updateConnectionStatus(t){const s=e("#ace-redis-cache-connection"),a=e("#ace-redis-cache-size");s.text(t.status).removeClass("status-unknown status-error").addClass("status-success");let i=`${t.size} keys (${t.size_kb} KB)`;t.debug_info&&(i+=` - ${t.debug_info}`),a.text(i)}showConnectionError(t){const s=e("#ace-redis-cache-connection"),a=e("#ace-redis-cache-size");s.text(t).removeClass("status-unknown status-success").addClass("status-error"),a.text("0 keys (0 KB)")}initCacheManagement(){e("#ace-redis-cache-flush-btn").on("click",e=>{e.preventDefault(),this.clearAllCache()}),e("#ace-redis-cache-flush-blocks-btn").on("click",e=>{e.preventDefault(),this.clearBlockCache()})}clearAllCache(){if(!confirm("Are you sure you want to clear all cache? This action cannot be undone."))return;const t=e("#ace-redis-cache-flush-btn"),s=t.text();t.text("Clearing...").prop("disabled",!0),e.post(ace_redis_admin.ajax_url,{action:"ace_redis_cache_flush",nonce:ace_redis_admin.nonce}).done(t=>{t.success?(this.showNotification(`✅ ${t.data.message||"Cache cleared successfully"}`,"success"),e("#ace-redis-cache-size").text("0 keys (0 KB)")):this.showNotification(`❌ Failed to clear cache: ${t.data}`,"error")}).fail(()=>{this.showNotification("❌ AJAX request failed","error")}).always(()=>{t.text(s).prop("disabled",!1)})}clearBlockCache(){if(!confirm("Clear all block cache? This will remove cached Gutenberg blocks."))return;const t=e("#ace-redis-cache-flush-blocks-btn"),s=t.text();t.text("Clearing...").prop("disabled",!0),e.post(ace_redis_admin.ajax_url,{action:"ace_redis_cache_flush_blocks",nonce:ace_redis_admin.nonce}).done(e=>{e.success?(this.showNotification(`✅ ${e.data.message||"Block cache cleared"}`,"success"),setTimeout(()=>this.testConnection(),500)):this.showNotification(`❌ Failed to clear block cache: ${e.data}`,"error")}).fail(()=>{this.showNotification("❌ AJAX request failed","error")}).always(()=>{t.text(s).prop("disabled",!1)})}initDiagnostics(){e("#ace-redis-cache-diagnostics-btn").on("click",e=>{e.preventDefault(),this.runDiagnostics()})}runDiagnostics(){const t=e("#ace-redis-cache-diagnostics-btn"),s=e("#diagnostics-results"),a=t.text();t.text("Running...").prop("disabled",!0),s.html("<p>⏳ Running comprehensive diagnostics...</p>"),e.post(ace_redis_admin.ajax_url,{action:"ace_redis_cache_diagnostics",nonce:ace_redis_admin.nonce}).done(e=>{if(e.success&&e.data){const t=Array.isArray(e.data)?e.data.join("\n"):e.data;s.html(`<pre>${this.escapeHtml(t)}</pre>`)}else s.html(`<p class="error">❌ Failed to load diagnostics: ${e.data||"Unknown error"}</p>`)}).fail(()=>{s.html('<p class="error">❌ Diagnostics request failed</p>')}).always(()=>{t.text(a).prop("disabled",!1)})}initFormValidation(){e("#ace-redis-save-btn").on("click",e=>{if(!this.validateForm())return e.preventDefault(),!1}),e("#redis_host").on("blur",this.validateHost),e("#redis_port").on("blur",this.validatePort),e("#cache_ttl").on("blur",this.validateTTL)}validateForm(){let t=!0;const s=[];e("#redis_host").val().trim()||(s.push("Redis host is required"),t=!1);const a=parseInt(e("#redis_port").val());(!a||a<1||a>65535)&&(s.push("Redis port must be between 1 and 65535"),t=!1);const i=parseInt(e("#cache_ttl").val());return(!i||i<60)&&(s.push("Cache TTL must be at least 60 seconds"),t=!1),t||this.showNotification(`❌ Validation errors:\n${s.join("\n")}`,"error"),t}validateHost(){const t=e(this);return t.val().trim()?(t.removeClass("error"),!0):(t.addClass("error"),!1)}validatePort(){const t=e(this),s=parseInt(t.val());return!s||s<1||s>65535?(t.addClass("error"),!1):(t.removeClass("error"),!0)}validateTTL(){const t=e(this),s=parseInt(t.val());return!s||s<60?(t.addClass("error"),!1):(t.removeClass("error"),!0)}showNotification(e,t="info"){alert(e)}initAjaxForm(){console.log("Initializing AJAX form..."),e("#ace-redis-settings-form").on("submit",e=>(console.log("Form submit intercepted"),e.preventDefault(),e.stopPropagation(),this.saveSettings(),!1)),e("#ace-redis-save-btn").on("click",e=>(console.log("Save button clicked"),e.preventDefault(),e.stopPropagation(),this.saveSettings(),!1))}initChangeTracking(){setTimeout(()=>{const t=e("#ace-redis-save-btn");t.data("original-text")||t.data("original-text",t.val()),this.captureOriginalFormData(),this.updateSaveButtonState(),e("#ace-redis-settings-form input, #ace-redis-settings-form select, #ace-redis-settings-form textarea").on("input change",()=>{setTimeout(()=>this.updateSaveButtonState(),10)})},100)}captureOriginalFormData(){this.originalFormData=this.getFormDataObject()}hasFormChanges(){if(!this.originalFormData)return!1;const e=this.getFormDataObject();return JSON.stringify(this.originalFormData)!==JSON.stringify(e)}updateSaveButtonState(){const t=e("#ace-redis-save-btn"),s=this.hasFormChanges();t.prop("disabled",!s),s?t.val(t.data("original-text")||"Save Changes"):t.val(t.data("original-text")||"Save Changes (No Changes)")}getFormDataObject(){const t=e("#ace-redis-settings-form"),s={};return t.serializeArray().forEach(e=>{if(e.name.startsWith("ace_redis_cache_settings[")){const t=e.name.replace("ace_redis_cache_settings[","").replace("]","");s[t]=e.value}}),t.find('input[type="checkbox"]').each(function(){const t=e(this).attr("name");if(t&&t.startsWith("ace_redis_cache_settings[")){const a=t.replace("ace_redis_cache_settings[","").replace("]","");s[a]=e(this).is(":checked")?"1":"0"}}),s}saveSettings(){if(!this.hasFormChanges())return void this.showMessage("Error: Failed to save settings. No changes detected or database error.","error");e("#ace-redis-settings-form");const t=e("#ace-redis-save-btn"),s=e("#ace-redis-messages");console.log("REST API Save triggered...");const a=t.val();t.val("Saving...").prop("disabled",!0),s.hide();const i=this.getFormDataObject();console.log("Sending data:",i),console.log("REST URL:",ace_redis_admin.rest_url+"ace-redis-cache/v1/settings"),e.ajax({url:ace_redis_admin.rest_url+"ace-redis-cache/v1/settings",type:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ace_redis_admin.rest_nonce),console.log("Set REST nonce:",ace_redis_admin.rest_nonce)},contentType:"application/json",data:JSON.stringify({settings:i,nonce:ace_redis_admin.nonce}),success:e=>{console.log("Success response:",e),e.success?(this.showMessage(e.message||"Settings saved successfully!","success"),this.captureOriginalFormData(),this.updateSaveButtonState(),setTimeout(()=>{"function"==typeof this.testConnection&&this.testConnection()},1e3)):this.showMessage(e.message||"Failed to save settings","error")},error:(e,t,s)=>{console.error("Save error:",{status:e.status,statusText:e.statusText,responseText:e.responseText,error:s});let a="Network error occurred";a=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:504===e.status?"Gateway timeout - settings may still be saved. Please refresh the page.":403===e.status?"Permission denied. Please refresh the page and try again.":404===e.status?"REST API endpoint not found. The plugin may not be properly configured.":`${s} (Status: ${e.status})`,this.showMessage("Error: "+a,"error")},complete:()=>{t.val(a).prop("disabled",!1)}})}showMessage(t,s="success"){const a=e("#ace-redis-messages"),i="success"===s?"notice-success":"notice-error";a.html(`\n                <div class="notice ${i} is-dismissible">\n                    <p>${this.escapeHtml(t)}</p>\n                    <button type="button" class="notice-dismiss">\n                        <span class="screen-reader-text">Dismiss this notice.</span>\n                    </button>\n                </div>\n            `).show(),"success"===s&&setTimeout(()=>{a.fadeOut()},5e3),a.find(".notice-dismiss").on("click",function(){a.fadeOut()})}initPerformanceMetrics(){this.loadPerformanceMetrics(),setInterval(()=>{this.loadPerformanceMetrics()},3e4)}loadPerformanceMetrics(){e.ajax({url:ace_redis_admin.ajax_url,type:"POST",data:{action:"ace_redis_cache_metrics",nonce:ace_redis_admin.nonce},success:e=>{e.success&&this.updateMetricsDisplay(e.data)},error:()=>{}})}updateMetricsDisplay(t){e("#performance-metrics .metric-card").each(function(){const s=e(this),a=s.find(".metric-value");switch(s.find("h4").text()){case"Cache Hit Rate":a.text(t.cache_hit_rate||"--");break;case"Memory Usage":a.text(t.memory_usage||"--");break;case"Total Keys":a.text(t.total_keys||"--");break;case"Connection Time":a.text(t.connection_time||"--")}})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}e(document).ready(()=>{new t})}(jQuery);
//# sourceMappingURL=admin.min.js.map